!function(t,e){var n=e();"object"==typeof module&&module&&(module.exports=n),"function"==typeof define&&define.amd&&define(e),t.PromisePolyfill=n,t.Promise||(t.Promise=n)}("undefined"!=typeof global?global:this,function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function e(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function n(t){if(!(this instanceof n))throw new TypeError(this+"is not a promise");if("function"!=typeof t)throw new TypeError("Promise resolver "+t+" is not a function");var e=new r;this._resolver=e;try{t(function(t){e.resolve(t)},function(t){e.reject(t)})}catch(s){e.reject(s)}}function r(){this._callbacks=[],this._errbacks=[],this._status="pending",this._result=null}return e(n.prototype,{then:function(t,e){var r,s,i=new this.constructor(function(t,e){r=t,s=e});return this._resolver._addCallbacks("function"==typeof t?n._makeCallback(i,r,s,t):r,"function"==typeof e?n._makeCallback(i,r,s,e):s),i},"catch":function(t){return this.then(void 0,t)}}),n._makeCallback=function(t,e,n,r){return function(s){var i;try{i=r(s)}catch(o){return void n(o)}return i===t?void n(new TypeError("Cannot resolve a promise with itself")):void e(i)}},n.resolve=function(t){return t&&t.constructor===this?t:new this(function(e){e(t)})},n.reject=function(t){var e=new this(function(){});return e._resolver._result=t,e._resolver._status="rejected",e},n.all=function(e){var n=this;return new n(function(r,s){function i(t){return function(e){u[t]=e,o--,o||r(u)}}if(!t(e))return void s(new TypeError("Promise.all expects an array of values or promises"));var o=e.length,c=0,a=e.length,u=[];if(a<1)return r(u);for(;c<a;c++)n.resolve(e[c]).then(i(c),s)})},n.race=function(e){var n=this;return new n(function(r,s){if(!t(e))return void s(new TypeError("Promise.race expects an array of values or promises"));for(var i=0,o=e.length;i<o;i++)n.resolve(e[i]).then(r,s)})},n.async="undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(t){setTimeout(t,0)},e(r.prototype,{fulfill:function(t){var e=this._status;"pending"!==e&&"accepted"!==e||(this._result=t,this._status="fulfilled"),"fulfilled"===this._status&&(this._notify(this._callbacks,this._result),this._callbacks=[],this._errbacks=null)},reject:function(t){var e=this._status;"pending"!==e&&"accepted"!==e||(this._result=t,this._status="rejected"),"rejected"===this._status&&(this._notify(this._errbacks,this._result),this._callbacks=null,this._errbacks=[])},resolve:function(t){"pending"===this._status&&(this._status="accepted",this._value=t,(this._callbacks&&this._callbacks.length||this._errbacks&&this._errbacks.length)&&this._unwrap(this._value))},_unwrap:function(t){var e,n=this,r=!1;if(!t||"object"!=typeof t&&"function"!=typeof t)return void n.fulfill(t);try{e=t.then,"function"==typeof e?e.call(t,function(t){r||(r=!0,n._unwrap(t))},function(t){r||(r=!0,n.reject(t))}):n.fulfill(t)}catch(s){r||n.reject(s)}},_addCallbacks:function(t,e){var n=this._callbacks,r=this._errbacks;switch(n&&n.push(t),r&&r.push(e),this._status){case"accepted":this._unwrap(this._value);break;case"fulfilled":this.fulfill(this._result);break;case"rejected":this.reject(this._result)}},_notify:function(t,e){t.length&&n.async(function(){var n,r;for(n=0,r=t.length;n<r;++n)t[n](e)})}}),n.Resolver=r,n});